{% extends "main/base.html" %}

{% block css_link %} <link rel="stylesheet" href="/static/css/notes.css"> {% endblock %}

{% block content %}
    <article class="notes">
			<section class="mast">
				<h1>Заметки</h1>
			</section>
			<section class="content">
				<section class="navigation">
					<nav class="navbar">
						<div class="btn-group btn-group-lg">
							<button type="button" class="btn btn-warning" onclick="show_cards();">
								<picture>
									<img src="/static/icons/card_icon.png" class="icon">
								</picture>
							</button>
							<button type="button" class="btn btn-warning" onclick="show_list();">
								<picture>
									<img src="/static/icons/list_icon.png" class="icon">
								</picture>
							</button>
						</div>
						<button type="button" class="btn btn-lg btn-warning" data-toggle="modal" data-target="#New">+</button>
						<div class="btn-group btn-group-lg">
							<button type="button" class="btn btn-warning">Сначала новые</button>
							<button type="button" class="btn btn-warning">Сначала старые</button>
							<button type="button" class="btn btn-warning">А..Я</button>
							<button type="button" class="btn btn-warning">Я..А</button>
						</div>
						<div class="alert alert-warning">
							<small>Всего заметок: 42</small> <br/>
							<small>Текстовых: 24</small> <br/>
							<small>Голосовых: 18</small> <br/>
						</div>
						<form id="search_form" onsubmit="return false;">
							{% load bootstrap %}
							{% csrf_token %}
							{{ search_form.result | bootstrap }}
						</form>
						<input id="search_btn" type="button" value="Search" class="btn btn-warning" onclick="search_ajax();">
					</nav>
				</section>
				<section class="list-view">
					<div class="list-group" id="list_id">
						{% for item in notes_data %}
							<a href="#" class="list-group-item list-group-item-action list-group-item-warning" data-toggle="modal" data-target="#Open-{{item.2}}">
								{{ item.0 }}
								<div class="date"> <small>{{ item.1 }}</small></div>
							</a>
						{% endfor %}
					</div>
				</section>
				<section class="card-view" hidden>
					<div class="row" id="cards_id">
						{% for item in notes_data %}
							<div class="col-md-4" data-toggle="modal" data-target="#Open-{{item.2}}">
							<div class="card">
								<div class="card-body">
									<h3> {{ item.0 }} <small class="date">{{ item.1 }}</small></h3>
									<hr/>
									<p>
										...
									</p>
								</div>
							</div>
						</div>
						{% endfor %}
					</div>
				</section>
				<nav class="navbar">
					<div class="btn-group btn-group-lg">
						<a href="#"><button type="button" class="btn btn-warning">&laquo;</button></a>
						<a href="#"><button type="button" class="btn btn-warning disabled">1</button></a>
						<a href="#"><button type="button" class="btn btn-warning">2</button></a>
						<a href="#"><button type="button" class="btn btn-warning">3</button></a>
						<a href="#"><button type="button" class="btn btn-warning">&raquo;</button></a>
					</div>
				</nav>
			</section>
		</article>
		<article class="modals">

			<div class="modal fade" id="New">
				<div class="modal-dialog modal-lg modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h2>Создание заметки</h2>
						</div>
						<div class="modal-body">
							<form id="add_form">
								{% csrf_token %}
								{{ add_form.media }}
								<h3>Название</h3>
								{{ add_form.title }}
								<h3>Текст</h3>
								{{ add_form.data}}
								<h3> Изображение </h3>
								<div class="form-group btn btn-warning">
									<input type="file" class="form-control-file">
								</div>
							</form>
							<h3>Записать аудио</h3>
							<button type="button" class="btn btn-warning btn-lg btn-block">
								<picture>
									<img src="/static/icons/micro_icon.png">
								</picture>
							</button>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-danger" data-dismiss="modal">Отменить</button>
							<button type="button" class="btn btn-warning" data-dismiss="modal">Создать</button>
						</div>
					</div>
				</div>
			</div>
			{% for item in notes_data %}
				<div class="modal fade" id="Open-{{item.2}}">
					<div class="modal-dialog modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header">
								<h2>{{ item.0 }}</h2>
							</div>
							<div class="modal-body">
								<p>
									{% autoescape off %}{{ item.3.0 }}{% endautoescape %}

								</p>
								<small>{{ item.1 }}</small> <br/>
								<small class="text-muted">4.03.2018 (редакт.)</small>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-danger" data-dismiss="modal">Отменить</button>
								<button type="button" class="btn btn-danger" data-dismiss="modal">Удалить</button>
								<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#Edit" onclick="set_cke_data({{ item.3}}, '{{ item.0 }}')">Редактировать</button>
								<button type="button" class="btn btn-warning">Прослушать</button>
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
			<div class="modal fade" id="Open-Image">
				<div class="modal-dialog modal modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h2>Fake Plastic Trees</h2>
						</div>
						<div class="modal-body">
							<p>She looks like the real thing <br/>
								She tastes like the real thing <br/>
								My fake plastic love <br/>
							</p>
							<picture>
								<img src="/static/img/for_notes.jpg" class="user-image">
							</picture>
							<br/>
							<small>27.02.2018</small> <br/>
							<small class="text-muted">4.03.2018 (редакт.)</small>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-danger" data-dismiss="modal">Отменить</button>
							<button type="button" class="btn btn-danger" data-dismiss="modal">Удалить</button>
							<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#Edit">Редактировать</button>
							<button type="button" class="btn btn-warning">Прослушать</button>
						</div>
					</div>
				</div>
			</div>
			<div class="modal fade" id="Open-Sound">
				<div class="modal-dialog modal modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h2>Lucky</h2>
						</div>
						<div class="modal-body">
							<button type="button" class="btn btn-warning btn-lg btn-block">
								<picture>
									<img src="/static/icons/sound_icon.png">
								</picture>
							</button>
							<small>22.02.2018</small> <br/>
							<small class="text-muted">4.03.2018 (редакт.)</small>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-danger" data-dismiss="modal">Отменить</button>
							<button type="button" class="btn btn-danger" data-dismiss="modal">Удалить</button>
							<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#Edit">Редактировать</button>
						</div>
					</div>
				</div>
			</div>

			<div class="modal fade" id="Edit">
				<div class="modal-dialog modal-lg modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h2>Редактирование заметки</h2>
						</div>
						<div class="modal-body">
							<form>
								{% csrf_token %}
								{{ show_form.meia }}
								<h3>Изменить название</h3>
								{{ show_form.title_show }}
								<h3>Изменить текст</h3>
								<h3> Изменить изображение </h3>
								{{ show_form.data_show }}
							</form>
							<h3>Переписать аудио</h3>
							<button type="button" class="btn btn-warning btn-lg btn-block">
								<picture>
									<img src="/static/icons/micro_icon.png">
								</picture>
							</button>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-danger" data-dismiss="modal">Отменить</button>
							<button class="btn btn-warning" data-dismiss="modal">Сохранить</button>
						</div>
					</div>
				</div>
			</div>
		</article>
    <script>
        function show_cards(){
    		$('.list-view').hide();
    		$('.card-view').hide();
    		$('.card-view').removeAttr('hidden');
    		$('.card-view').show('slow');
    	};

    	function show_list(){
    		$('.card-view').hide();
    		$('.list-view').hide();
    		$('.list-view').removeAttr('hidden');
    		$('.list-view').slideDown('slow');
    	};

    	function set_cke_data(val_data, val_title){
    		CKEDITOR.instances.id_data_show.setData(val_data[0]);
    		$('#id_title_show').val(val_title);
    	};

        function search_ajax()
            {
                form_data = $('#search_form').serialize();
                $("#search_form").find(':input').each(function(){
                    $(this).attr('disabled', 'disabled');
                });
                $('#sign_up_btn').attr('disabled', 'disabled');
                $.ajax({
                    type: "POST",
                    url: '/notes/search',
                    data: form_data,
                    success: function(response)
                    {
                        if (response['result'] == "Success")
                        {
                            $("#list_id").html('');
                            for (var i = 0; i < response['notes_list'].length; i++) {
                                $("#list_id").append('<a href="#" class="list-group-item list-group-item-action list-group-item-warning" data-toggle="modal" data-target=#Open-'
                                +response['notes_list'][i][2] + '>' + response['notes_list'][i][0] + '<div class="date"> <small>'
                                + response['notes_list'][i][1] + '</small></div></a>')
                            }
                        }
                        $("#search_form").find(':input').each(function(){
                            $(this).removeAttr('disabled');
                        });
                        $('#sign_up_btn').removeAttr('disabled');
                    }
                });
            };
    </script>

    <script>
        function sort_ajax(type){
                result = "";
                $.ajax({
                    type: "POST",
                    url: '/notes/sort',
                    data: {"data": type},
                    success: function(response)
                    {
                        if (response['result'] == "Success")
                        {
                            $("#notes_list").html('');
                            for (var i = 0; i < response['notes_list'].length; i++) {
                                $("#notes_list").append("<li><a href='/notes/show/" + response['notes_list'][i][2] + "'>" + response['notes_list'][i][0] + "</a></li> - added at " + response['notes_list'][i][1])
                            }
                        }
                    }
                });
            };
    </script>

{% endblock %}
