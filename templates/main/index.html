{% extends "main/base.html" %}

{% block content %}
    <h1>{{ header }}</h1>
    <p>Welcome to the index page</p>
    {% if user.is_authenticated %}
        <a href="sign_out">Sign out</a>
    {% else %}
        {% if just_signed_up %}
            <h2>You have successfully signed up! Check your email to confirm it!</h2>
        {% else %}
            <form id="sign_in_form">
                {% csrf_token %}
                {{ sign_in_form.as_p }}
            </form>
            <input type="submit" value="Sign in" onclick="sign_in_ajax()" id="sign_in_btn">
            <a href="/sign_up">Sign up</a>
            <script>
                function sign_in_ajax()
                {
                    form_data = $('#sign_in_form').serialize();
                    $("#sign_in_form").find(':input').each(function(){
                        $(this).attr('disabled', 'disabled');
                    });
                    $('#sign_in_btn').attr('disabled', 'disabled');
                    $.ajax({
                        type: "POST",
                        url: '/sign_in/',
                        data: form_data,
                        success: function(response)
                        {
                            alert(response['result']);
                            if (response['result'] == "Success")
                            {
                                window.location.href = '/';
                            }
                            $("#sign_in_form").find(':input').each(function(){
                               $(this).removeAttr('disabled');
                            });
                            $('#sign_in_btn').removeAttr('disabled');
                        }
                    });

                };
            </script>
        {% endif %}
    {% endif %}
{% endblock %}