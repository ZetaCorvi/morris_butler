{% extends "main/base.html" %}

{% block content %}
    <h1>{{ header }}</h1>
    <p>Welcome to the sign up page</p>
    <form id="sign_up_form">
        {% csrf_token %}
        {{ sign_up_form.as_p }}
    </form>
    <input type="submit" value="Sign up" onclick="sign_up_ajax()" id="sign_up_btn">
    <script>
        function sign_up_ajax()
            {
                result = "";
                $("#sign_up_form").each(function(){
                    if ($(this).find(':input').attr('name') != 'csrfmiddlewaretoken')
                    {
                        $(this).find(':input').attr('disabled', 'disabled');
                    }
                });
                $('#sign_up_btn').attr('disabled', 'disabled');
                $.ajax({
                    type: "POST",
                    url: '/sign_up/',
                    data: $('#sign_up_form').serialize(),
                    success: function(response)
                    {
                        alert(response['result']);
                        if (response['result'] == "Success")
                        {
                            window.location.href = '/?just_signed_up=True';
                        }
                        $("#sign_up_form").each(function(){
                            if ($(this).find(':input').attr('name') != 'csrfmiddlewaretoken')
                            {
                                $(this).find(':input').removeAttr('disabled');
                            }
                        });
                        $('#sign_up_btn').removeAttr('disabled');
                    }
                });
            };
    </script>
{% endblock %}